---
title: "IDS investigation worksheet"
author: Xu Sun
date: "`r Sys.Date()`"
output: html_document
---

**Note:** You can use this file as you 'working document' where you can try out various investigation ideas and keep notes about your findings. How you use and structure this file is up to you. It is recommended that you keep notes about what you are investigating and what you find as this will make the process of creating your presentation and report easier. Please note that you _do not_ need to submit this file as part of your group project.



```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r load-lib, message = FALSE}
library(tidyverse)
library(ggplot2)
# Add any other libraries here



```


```{r load-data}
# Load my data 
communities <- read_csv("data/communities.data")
glimpse(communities)

# Remove identifiers & Check missing values
data <- communities %>%
  select(-c(state, county, community, communityname, fold))
colSums(is.na(data)) %>% sort(decreasing = TRUE)
data_clean <- data %>% select(where(~ mean(is.na(.)) < 0.3))
data_clean <- data_clean %>% mutate(across(everything(), ~ replace_na(., mean(., na.rm = TRUE))))

str(data_clean)
summary(data_clean$ViolentCrimesPerPop)

# Distribution of Violent Crime
ggplot(data = data_clean, mapping = aes(x = ViolentCrimesPerPop)) +
  geom_histogram(bins = 50, fill = "navyblue", color = "white") +
  labs(title = "Distribution of Violent Crimes per Population", x = "Violent Crime Rate", y = "Count")

# Education vs. Crime
ggplot(data = data_clean, mapping = aes(x = PctNotHSGrad, y = ViolentCrimesPerPop)) +
  geom_point(alpha = 0.3) +
  geom_smooth(method = "lm", color = "yellow") +
  labs(title = "Violent Crime vs. % Without High School Education",
       x = "% Not High School Graduates",
       y = "Violent Crime Rate")


# Unemployment vs. Crime (95% confidence)
ggplot(data = data_clean, mapping = aes(x = PctUnemployed, y = ViolentCrimesPerPop)) +
  geom_point(alpha = 0.3) +
  geom_smooth(method = "lm", color = "pink") +
  labs(title = "Unemployment vs. Violent Crime",
       x = "% Unemployed", y = "Violent Crime Rate")


# Correlation with Crime 
correlations <- data_clean %>%
  select(-ViolentCrimesPerPop) %>%
  summarise(across(everything(), ~ cor(., data_clean$ViolentCrimesPerPop, use = "complete.obs"))) %>%
  pivot_longer(cols = everything(), names_to = "Variable", values_to = "Correlation") %>%
  arrange(desc(abs(Correlation)))
head(correlations, 30)

correlations %>%
  top_n(5, abs(Correlation)) %>%
  ggplot(aes(x = reorder(Variable, Correlation), y = Correlation, fill = Correlation > 0)) +
  geom_col(show.legend = FALSE) +
  coord_flip() +
  labs(title = "Top 5 Features Most Correlated with Violent Crime",
       x = "Variable", y = "Correlation")

#Income vs. Crime
ggplot(data_clean, aes(x = medIncome, y = ViolentCrimesPerPop)) +
  geom_point(alpha = 0.5, color = "black") +
  geom_smooth(method = "lm", color = "red") +
  labs(title = "Income vs. Violent Crime",
       x = "Median Income",
       y = "Violent Crimes per Population")


```
1. Pctllleg: percentage of kids born to never married (numeric - decimal)
This may reflect community-level social disorganization — weaker social networks, less supervision, and more economic strain.

2. PctYoungKids2Par: percent of kids 4 and under in two parent households (numeric - decimal)

3. racePctWhite: percentage of population that is caucasian (numeric - decimal)
A negative association indicates that under this dataset, communities with lower levels of White residents/inhabitants also tend to be associated with higher criminality levels (-0.68).
⚠️ Important: this does NOT mean that race causes crime, or not more than income, education, housing, or policing causes crime. The correlation may well represent systemic inequalities.
(reflect upon it as a socioeconomic, correlated variable rather than a causal racial difference)

4. PctFam2Par: percentage of families (with kids) that are headed by two parents (numeric - decimal)

5. PctKids2Par: percentage of kids in family housing with two parents (numeric - decimal)
From the correlation analysis, several strong relationships emerged between community family structure and violent crime rates.
Variables such as PctKids2Par (-0.74), PctFam2Par (-0.71), and PctYoungKids2Par (-0.67) show strong negative correlations with violent crime, indicating that communities with fewer two-parent families tend to experience higher levels of violent crime.

